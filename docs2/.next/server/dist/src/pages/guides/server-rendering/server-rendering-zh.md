module.exports = "# 服务端渲染\n\n<p class=\"description\">服务器端呈现的最常见用例是在用户（或搜索引擎爬虫）首次请求您的应用时处理初次渲染。</p>\n\n当服务器收到请求时，它会将所需的组件呈现为 HTML 字符串，然后将其作为响应发送给客户端。 从那时起，客户将接管渲染的职责。\n\n## 在服务器端的 Material-UI\n\nMaterial-UI 最初设计受到了在服务器端渲染的约束，但是您可以完全负责它的正确整合。 为页面提供所需的 CSS 是至关重要的，否则页面只会渲染 HTML 而等待客户端注入 CSS, 从而导致浏览器样式闪烁（FOUC）。 若想将样式注入客户端，我们需要：\n\n1. 在每个请求上创建一个全新的 [`ServerStyleSheets`](/styles/api/#serverstylesheets) 实例。\n2. 用服务端收集器渲染 React 树组件。\n3. 拉出 CSS。\n4. 将CSS传递给客户端。\n\n在删除服务器端注入的 CSS 之前，客户端将第二次注入 CSS。\n\n## 配置\n\n在下面的配置中，我们将了解如何设置服务器端的渲染。\n\n### 主题\n\nCreate a theme that will be shared between the client and the server:\n\n`theme.js`\n\n```js\nimport { createMuiTheme } from '@material-ui/core/styles';\nimport red from '@material-ui/core/colors/red';\n\n// 创建一个主题的实例。\nconst theme = createMuiTheme({\n  palette: {\n    primary: {\n      main: '#556cd6',\n    },\n    secondary: {\n      main: '#19857b',\n    },\n    error: {\n      main: red.A400,\n    },\n    background: {\n      default: '#fff',\n    },\n  },\n});\n```\n\n### 服务器端\n\nThe following is the outline for what the server-side is going to look like. We are going to set up an [Express middleware](https://expressjs.com/en/guide/using-middleware.html) using [app.use](https://expressjs.com/en/api.html) to handle all requests that come in to the server. If you're unfamiliar with Express or middleware, just know that the handleRender function will be called every time the server receives a request.\n\n`server.js`\n\n```js\nimport express from 'express';\n\n// 我们将在章节中填写这些内容来遵守。\nfunction renderFullPage(html, css) {\n  /* ... */\n}\n\nfunction handleRender(req, res) {\n  /* ... */\n}\n\nconst app = express();\n\n// 每次服务器端收到请求时都会触发此操作。\napp.use(handleRender);\n\nconst port = 3000;\napp.listen(port);\n```\n\n### 处理请求\n\n对于每次请求，我们首先需要做的是创建一个 `ServerStyleSheets`。\n\nWhen rendering, we will wrap `App`, the root component, inside a [`StylesProvider`](/styles/api/#stylesprovider) and [`ThemeProvider`](/styles/api/#themeprovider) to make the style configuration and the `theme` available to all components in the component tree.\n\nThe key step in server-side rendering is to render the initial HTML of the component **before** we send it to the client side. 我们用 [ReactDOMServer.renderToString()](https://reactjs.org/docs/react-dom-server.html) 来实现此操作。\n\nWe then get the CSS from the `sheets` using `sheets.toString()`. We will see how this is passed along in the `renderFullPage` function.\n\n```jsx\nimport express from 'express';\nimport React from 'react';\nimport ReactDOMServer from 'react-dom/server';\nimport { ServerStyleSheets, ThemeProvider } from '@material-ui/core/styles';\nimport App from './App';\nimport theme from './theme';\n\nfunction handleRender(req, res) {\n  const sheets = new ServerStyleSheets();\n\n  // Render the component to a string.\n  const html = ReactDOMServer.renderToString(\n    sheets.collect(\n      <ThemeProvider theme={theme}>\n        <App />\n      </ThemeProvider>,\n    ),\n  );\n\n  // Grab the CSS from the sheets.\n  const css = sheets.toString();\n\n  // 将渲染的页面送回到客户端。\n  res.send(renderFullPage(html, css));\n}\n\nconst app = express();\n\napp.use('/build', express.static('build'));\n\n// 每次服务器端收到请求时都会触发此操作。\napp.use(handleRender);\n\nconst port = 3000;\napp.listen(port);\n```\n\n### 注入组件的初始 HTML 和 CSS\n\nThe final step on the server-side is to inject the initial component HTML and CSS into a template to be rendered on the client side.\n\n```js\nfunction renderFullPage(html, css) {\n  return `\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <title>My page</title>\n        <style id=\"jss-server-side\">${css}</style>\n      </head>\n      <body>\n        <div id=\"root\">${html}</div>\n      </body>\n    </html>\n  `;\n}\n```\n\n### 客户端\n\n客户端则是简单明了的。 我们只需要移除服务器端生成的 CSS。 Let's take a look at the client file:\n\n`client.js`\n\n```jsx\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { ThemeProvider } from '@material-ui/core/styles';\nimport App from './App';\nimport theme from './theme';\n\nfunction Main() {\n  React.useEffect(() => {\n    const jssStyles = document.querySelector('#jss-server-side');\n    if (jssStyles) {\n      jssStyles.parentElement.removeChild(jssStyles);\n    }\n  }, []);\n\n  return (\n    <ThemeProvider theme={theme}>\n      <App />\n    </ThemeProvider>\n  );\n}\n\nReactDOM.hydrate(<Main />, document.querySelector('#root'));\n```\n\n## 参考实现\n\n您可以在 [GitHub 存储库中](https://github.com/Foso/material-ui)的 [`/examples`](https://github.com/Foso/material-ui/tree/master/examples) 的文件夹下面，找到我们托管的不同的范例项目：\n\n- [本教程的参考实现](https://github.com/Foso/material-ui/tree/master/examples/ssr)\n- [Gatsby](https://github.com/Foso/material-ui/tree/master/examples/gatsby)\n- [Next.js](https://github.com/Foso/material-ui/tree/master/examples/nextjs)\n\n## 故障排除（Troubleshooting）\n\nCheck out the FAQ answer: [My App doesn't render correctly on the server](/getting-started/faq/#my-app-doesnt-render-correctly-on-the-server).\n"