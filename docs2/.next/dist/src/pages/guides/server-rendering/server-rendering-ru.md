module.exports = "# Серверная отрисовка\n\n<p class=\"description\">Наиболее распространенный вариант использования для серверной отрисовки - это использовать начальную отрисовку, когда пользователь (или поисковой движок) впервые запрашивает ваше приложение.</p>\n\nКогда сервер получает запрос, он отрисовывает необходимые компоненты в HTML строк, а затем отправляет ее как ответ клиенту. С этого момента клиент берет на себя обязанности по отрисовке.\n\n## Material-UI on the server\n\nMaterial-UI was designed from the ground-up with the constraint of rendering on the server, but it's up to you to make sure it's correctly integrated. It's important to provide the page with the required CSS, otherwise the page will render with just the HTML then wait for the CSS to be injected by the client, causing it to flicker (FOUC). Чтобы добавить стили на клиент, вам необходимо:\n\n1. Create a fresh, new [`ServerStyleSheets`](/styles/api/#serverstylesheets) instance on every request.\n2. Render the React tree with the server-side collector.\n3. Pull the CSS out.\n4. Передать CSS клиенту.\n\nНа стороне клиента CSS будет добавлен второй раз перед удалением добавленного сервером CSS.\n\n## Настройка\n\nВ следующем рецепте мы рассмотрим, как настроить серверную отрисовку.\n\n### The theme\n\nCreate a theme that will be shared between the client and the server:\n\n`theme.js`\n\n```js\nimport { createMuiTheme } from '@material-ui/core/styles';\nimport red from '@material-ui/core/colors/red';\n\n// Create a theme instance.\nconst theme = createMuiTheme({\n  palette: {\n    primary: {\n      main: '#556cd6',\n    },\n    secondary: {\n      main: '#19857b',\n    },\n    error: {\n      main: red.A400,\n    },\n    background: {\n      default: '#fff',\n    },\n  },\n});\n\nexport default theme;\n```\n\n### The server-side\n\nThe following is the outline for what the server-side is going to look like. We are going to set up an [Express middleware](https://expressjs.com/en/guide/using-middleware.html) using [app.use](https://expressjs.com/en/api.html) to handle all requests that come in to the server. If you're unfamiliar with Express or middleware, just know that the handleRender function will be called every time the server receives a request.\n\n`server.js`\n\n```js\nimport express from 'express';\n\n// We are going to fill these out in the sections to follow.\nfunction renderFullPage(html, css) {\n  /* ... */\n}\n\nfunction handleRender(req, res) {\n  /* ... */\n}\n\nconst app = express();\n\n// Isso é acionado toda vez que o servidor recebe uma solicitação.\napp.use(handleRender);\n\nconst port = 3000;\napp.listen(port);\n```\n\n### Обработка запроса\n\nThe first thing that we need to do on every request is create a new `ServerStyleSheets`.\n\nWhen rendering, we will wrap `App`, the root component, inside a [`StylesProvider`](/styles/api/#stylesprovider) and [`ThemeProvider`](/styles/api/#themeprovider) to make the style configuration and the `theme` available to all components in the component tree.\n\nThe key step in server-side rendering is to render the initial HTML of the component **before** we send it to the client side. To do this, we use [ReactDOMServer.renderToString()](https://reactjs.org/docs/react-dom-server.html).\n\nWe then get the CSS from the `sheets` using `sheets.toString()`. We will see how this is passed along in the `renderFullPage` function.\n\n```jsx\nimport express from 'express';\nimport React from 'react';\nimport ReactDOMServer from 'react-dom/server';\nimport { ServerStyleSheets, ThemeProvider } from '@material-ui/core/styles';\nimport App from './App';\nimport theme from './theme';\n\nfunction handleRender(req, res) {\n  const sheets = new ServerStyleSheets();\n\n  // Render the component to a string.\n  const html = ReactDOMServer.renderToString(\n    sheets.collect(\n      <ThemeProvider theme={theme}>\n        <App />\n      </ThemeProvider>,\n    ),\n  );\n\n  // Grab the CSS from the sheets.\n  const css = sheets.toString();\n\n  // Send the rendered page back to the client.\n  res.send(renderFullPage(html, css));\n}\n\nconst app = express();\n\napp.use('/build', express.static('build'));\n\n// This is fired every time the server-side receives a request.\napp.use(handleRender);\n\nconst port = 3000;\napp.listen(port);\n```\n\n### Inject Initial Component HTML and CSS\n\nThe final step on the server-side is to inject the initial component HTML and CSS into a template to be rendered on the client side.\n\n```js\nfunction renderFullPage(html, css) {\n  return `\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <title>My page</title>\n        <style id=\"jss-server-side\">${css}</style>\n      </head>\n      <body>\n        <div id=\"root\">${html}</div>\n      </body>\n    </html>\n  `;\n}\n```\n\n### The Client Side\n\nThe client side is straightforward. All we need to do is remove the server-side generated CSS. Let's take a look at the client file:\n\n`client.js`\n\n```jsx\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { ThemeProvider } from '@material-ui/core/styles';\nimport App from './App';\nimport theme from './theme';\n\nfunction Main() {\n  React.useEffect(() => {\n    const jssStyles = document.querySelector('#jss-server-side');\n    if (jssStyles) {\n      jssStyles.parentElement.removeChild(jssStyles);\n    }\n  }, []);\n\n  return (\n    <ThemeProvider theme={theme}>\n      <App />\n    </ThemeProvider>\n  );\n}\n\nReactDOM.hydrate(<Main />, document.querySelector('#root'));\n```\n\n## Reference implementations\n\nWe host different reference implementations which you can find in the [GitHub repository](https://github.com/Foso/material-ui) under the [`/examples`](https://github.com/Foso/material-ui/tree/master/examples) folder:\n\n- [The reference implementation of this tutorial](https://github.com/Foso/material-ui/tree/master/examples/ssr)\n- [Gatsby](https://github.com/Foso/material-ui/tree/master/examples/gatsby)\n- [Next.js](https://github.com/Foso/material-ui/tree/master/examples/nextjs)\n\n## Troubleshooting\n\nCheck out the FAQ answer: [My App doesn't render correctly on the server](/getting-started/faq/#my-app-doesnt-render-correctly-on-the-server).\n"